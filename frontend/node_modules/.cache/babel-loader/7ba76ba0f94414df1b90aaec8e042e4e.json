{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\S\\\\Documents\\\\Proyecto-Backend-1\\\\frontend\\\\src\\\\pages\\\\History\\\\Page.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nimport \"./style.scss\";\nimport { useSelector } from \"react-redux\";\nimport { getUrl } from \"../../services/apiSlice\";\nimport { fetchHistory, fetchPost } from \"../../services/api\";\nimport { Spinner } from \"../../components/spinners\";\nimport { getUser } from \"../../services/userSlice\";\nimport { ProductCard } from \"../../components/product\";\nimport { useNavigate } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Page = () => {\n  _s();\n\n  const navigate = useNavigate();\n  const [historyData, setHistoryData] = React.useState(undefined);\n  const API_URL = useSelector(getUrl);\n  const userData = useSelector(getUser);\n\n  const fetch = async () => {\n    let history = await fetchHistory({\n      url: API_URL,\n      params: {\n        user_id: userData._id\n      }\n    });\n    const productData = await Promise.all(history.map(item => fetchPost({\n      url: API_URL,\n      params: {\n        post_id: item.product_id\n      }\n    })));\n    history = history.map((item, i) => ({ ...item,\n      product_data: productData[i]\n    }));\n    setHistoryData(history);\n  };\n\n  React.useEffect(() => {\n    if (userData) {\n      fetch();\n    } else {\n      navigate('/');\n    }\n  }, []);\n\n  if (!historyData) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {\n      text: 'Loading history...'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page history\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Purchase History\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: 'history__items',\n      children: historyData.length > 0 ? historyData.map((item, key) => /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(ProductCard, {\n          data: item.product_data\n        }, key, false, {\n          fileName: _jsxFileName,\n          lineNumber: 51,\n          columnNumber: 25\n        }, this)\n      }, void 0, false)) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: 'history__no-items',\n        children: \" No items in history. \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 12\n  }, this);\n};\n\n_s(Page, \"DwShT9ETyu+a8dRqPQvcXMASdC8=\", false, function () {\n  return [useNavigate, useSelector, useSelector];\n});\n\n_c = Page;\nexport default Page;\n\nvar _c;\n\n$RefreshReg$(_c, \"Page\");","map":{"version":3,"sources":["C:/Users/S/Documents/Proyecto-Backend-1/frontend/src/pages/History/Page.js"],"names":["React","useSelector","getUrl","fetchHistory","fetchPost","Spinner","getUser","ProductCard","useNavigate","Page","navigate","historyData","setHistoryData","useState","undefined","API_URL","userData","fetch","history","url","params","user_id","_id","productData","Promise","all","map","item","post_id","product_id","i","product_data","useEffect","length","key"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,cAAP;AACA,SAAQC,WAAR,QAA0B,aAA1B;AACA,SAAQC,MAAR,QAAqB,yBAArB;AACA,SAAQC,YAAR,EAAsBC,SAAtB,QAAsC,oBAAtC;AACA,SAAQC,OAAR,QAAsB,2BAAtB;AACA,SAAQC,OAAR,QAAsB,0BAAtB;AACA,SAAQC,WAAR,QAA0B,0BAA1B;AACA,SAAQC,WAAR,QAA0B,cAA1B;;;;AAEA,MAAMC,IAAI,GAAG,MAAM;AAAA;;AACf,QAAMC,QAAQ,GAAGF,WAAW,EAA5B;AACA,QAAM,CAACG,WAAD,EAAcC,cAAd,IAAgCZ,KAAK,CAACa,QAAN,CAAeC,SAAf,CAAtC;AACA,QAAMC,OAAO,GAAGd,WAAW,CAACC,MAAD,CAA3B;AACA,QAAMc,QAAQ,GAAGf,WAAW,CAACK,OAAD,CAA5B;;AAEA,QAAMW,KAAK,GAAG,YAAY;AACtB,QAAIC,OAAO,GAAG,MAAMf,YAAY,CAAC;AAACgB,MAAAA,GAAG,EAAEJ,OAAN;AAAeK,MAAAA,MAAM,EAAE;AAACC,QAAAA,OAAO,EAAEL,QAAQ,CAACM;AAAnB;AAAvB,KAAD,CAAhC;AAEA,UAAMC,WAAW,GAAG,MAAMC,OAAO,CAACC,GAAR,CACtBP,OAAO,CAACQ,GAAR,CAAYC,IAAI,IAAIvB,SAAS,CAAC;AAACe,MAAAA,GAAG,EAAEJ,OAAN;AAAeK,MAAAA,MAAM,EAAE;AAACQ,QAAAA,OAAO,EAAED,IAAI,CAACE;AAAf;AAAvB,KAAD,CAA7B,CADsB,CAA1B;AAIAX,IAAAA,OAAO,GAAGA,OAAO,CAACQ,GAAR,CAAY,CAACC,IAAD,EAAOG,CAAP,MAAc,EAChC,GAAGH,IAD6B;AACvBI,MAAAA,YAAY,EAAER,WAAW,CAACO,CAAD;AADF,KAAd,CAAZ,CAAV;AAIAlB,IAAAA,cAAc,CAACM,OAAD,CAAd;AACH,GAZD;;AAcAlB,EAAAA,KAAK,CAACgC,SAAN,CAAgB,MAAM;AAClB,QAAIhB,QAAJ,EAAc;AACVC,MAAAA,KAAK;AACR,KAFD,MAEO;AACHP,MAAAA,QAAQ,CAAC,GAAD,CAAR;AACH;AACJ,GAND,EAMG,EANH;;AAQA,MAAI,CAACC,WAAL,EAAkB;AACd,wBAAO,QAAC,OAAD;AAAS,MAAA,IAAI,EAAE;AAAf;AAAA;AAAA;AAAA;AAAA,YAAP;AACH;;AAED,sBAAO;AAAK,IAAA,SAAS,EAAE,cAAhB;AAAA,4BACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YADG,eAIH;AAAK,MAAA,SAAS,EAAE,gBAAhB;AAAA,gBAEIA,WAAW,CAACsB,MAAZ,GAAqB,CAArB,GAAyBtB,WAAW,CAACe,GAAZ,CAAgB,CAACC,IAAD,EAAOO,GAAP,kBACjC;AAAA,+BACI,QAAC,WAAD;AAEI,UAAA,IAAI,EAAEP,IAAI,CAACI;AAFf,WACSG,GADT;AAAA;AAAA;AAAA;AAAA;AADJ,uBADiB,CAAzB,gBASI;AAAK,QAAA,SAAS,EAAE,mBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAXR;AAAA;AAAA;AAAA;AAAA,YAJG;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AAmBH,CAnDD;;GAAMzB,I;UACeD,W,EAEDP,W,EACCA,W;;;KAJfQ,I;AAqDN,eAAeA,IAAf","sourcesContent":["import React from \"react\";\r\nimport \"./style.scss\"\r\nimport {useSelector} from \"react-redux\";\r\nimport {getUrl} from \"../../services/apiSlice\";\r\nimport {fetchHistory, fetchPost} from \"../../services/api\";\r\nimport {Spinner} from \"../../components/spinners\";\r\nimport {getUser} from \"../../services/userSlice\";\r\nimport {ProductCard} from \"../../components/product\";\r\nimport {useNavigate} from \"react-router\";\r\n\r\nconst Page = () => {\r\n    const navigate = useNavigate()\r\n    const [historyData, setHistoryData] = React.useState(undefined)\r\n    const API_URL = useSelector(getUrl)\r\n    const userData = useSelector(getUser);\r\n\r\n    const fetch = async () => {\r\n        let history = await fetchHistory({url: API_URL, params: {user_id: userData._id}})\r\n\r\n        const productData = await Promise.all(\r\n            history.map(item => fetchPost({url: API_URL, params: {post_id: item.product_id}}))\r\n        )\r\n\r\n        history = history.map((item, i) => ({\r\n            ...item, product_data: productData[i]\r\n        }))\r\n\r\n        setHistoryData(history)\r\n    }\r\n\r\n    React.useEffect(() => {\r\n        if (userData) {\r\n            fetch()\r\n        } else {\r\n            navigate('/')\r\n        }\r\n    }, [])\r\n\r\n    if (!historyData) {\r\n        return <Spinner text={'Loading history...'}/>\r\n    }\r\n\r\n    return <div className={\"page history\"}>\r\n        <h2>\r\n            Purchase History\r\n        </h2>\r\n        <div className={'history__items'}>\r\n        {\r\n            historyData.length > 0 ? historyData.map((item, key) =>\r\n                    <>\r\n                        <ProductCard\r\n                            key={key}\r\n                            data={item.product_data}\r\n                        />\r\n                    </>\r\n                )\r\n                :\r\n                <div className={'history__no-items'}> No items in history. </div>\r\n        }\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default Page"]},"metadata":{},"sourceType":"module"}